@using FoodDeliveryWebApplication;
@model dynamic


@{
    ViewBag.Title = "AcceptedOrders";
    Layout = "~/Views/Shared/_DeliveryStaffLayoutPage.cshtml";
}







<section style="padding-top:10em">
    <div class="container">


        <h2 class="mt-5">Accepted Requests</h2>
        <hr />


        <table class="table table-hover mt-3 ">
            <tr class="table-secondary">
                <th>
                    Order Id
                </th>
                <th>
                    Ordered Items
                </th>

                <th>
                    Customer Name
                </th>
                <th>
                    Customer Address
                </th>
                <th>
                    Customer Phone Number
                </th>



                <th>
                    Order Date
                </th>


                <th>
                    Order Confirmation
                </th>
                <th>
                    Order Delivered ?
                </th>
                <th>
                    Order Picked ?
                </th>




                <th></th>
            </tr>

            @foreach (var item in Model.Order)
            {
        <tr>
            <td>
                @item.fk_OrderId
            </td>
            <td>
                <table border="1">
                    <tr class="border border-1 border-dark bg-light">
                        <td class="p-2 border border-1 border-dark">
                            Dish id
                        </td>
                        <td class="p-2 border border-1 border-dark">
                            Dish Name
                        </td>
                        <td class="p-2 border border-1 border-dark">
                            Quantity(Nos)
                        </td>
                    </tr>
                    @foreach (var dish in Model.Cart)
                    {
                        <tr>
                            <td class="text-center border border-1 border-dark">
                                @dish.DishId
                            </td>
                            <td class="text-center border border-1 border-dark">
                                @dish.DishName
                            </td>
                            <td class="text-center border border-1 border-dark">
                                @dish.Quantity
                            </td>
                        </tr>

                    }
                </table>

            </td>

            <td>
                @item.CusName
            </td>
            <td>
                <table>
                    <tr>
                        <td>
                            Door/Flat No.
                        </td>
                        <td>
                            : @Model.Address.DoorOrFlatNo
                        </td>
                    </tr>

                    <tr>
                        <td>
                            LandMark
                        </td>
                        <td>
                            : @Model.Address.LandMark
                        </td>
                    </tr>
                    <tr>
                        <td>
                            PinCode
                        </td>
                        <td>
                            : @Model.Address.PinCode
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Address Type
                        </td>
                        <td>
                            : @Model.Address.AddressTypeName
                        </td>
                    </tr>


                </table>


            </td>
            <td>
                @foreach (var ph in Model.Phone)
                {
                    <p>@ph.PhoneNumber</p>
                }
            </td>


            <td>
                @item.Orderdate.ToShortDateString()
            </td>

            <td>
                @item.IsOrderConfirmed
            </td>
            <td>
                @item.IsDelivered
            </td>
            <td>
                @if (item.IsPicked == "Picked")
                {
                    <button class="btn btn-primary disabled btnPicked" id="@item.fk_OrderId">Picked</button>
                }
                else
                {
                    <button class="btn btn-primary btnPick ">Yes</button>

                }


            </td>

            <td>
                <button style="display:none" class="btn btn-primary btnFinish " id="@item.fk_OrderId">Finish Delivery</button>
                <input type="hidden" value="@item.fk_OrderId" id="hdnOrderId" />

            </td>
            <td>
                <button style="display:none" class="btn btn-danger btnCancel ">Cancel</button>


            </td>
        </tr>
            }

        </table>
    </div>
    <div class="mt-3 mx-auto" id="otpForm">

    </div>
</section>

<script src="~/Scripts/jquery-3.4.1.min.js"></script>

<script>
    $(".btnFinish").click(function () {
        var divResult = $("#otpForm")
        $(".btnCancel").fadeIn(3000);
        var orderId = $("#hdnOrderId").val();
        var url = "/DeliveryBoy/_AddOtpFormView/";
        $.ajax({
            type: "GET",
            url: url,
            data: { "id": orderId },
            success: function (data) {
                divResult.html('');
                divResult.html(data);

            },
            error: function (err) {
                alert(err)
            }

        })

    });

    $(".btnCancel").click(function () {
        $("#otpForm").html('');
        $(".btnCancel").fadeOut("3000");
    });

    $(".btnPick").click(function () {
        var orderId = $("#hdnOrderId").val();
        var url = "/DeliveryBoy/OrderPicked/";
        $.ajax({
            type: "POST",
            url: url,
            data: { "id": orderId },
            success: function (result) {
                if (result == "Success") {
                    confirm("Option for completing this delivery is available now. Once you delivered the item, Please click on Finish Delivery buttton and enter the otp given by the customer. That's all! Happy ride!");
                    $(".btnFinish").show();
                }
                else {
                    alert(result);
                }
                

            },
            error: function (err) {
                alert(err)
            }

        })
    })

    $(document).ready(function () {
        $(".btnPicked").each(function () {

                $(".btnFinish").show();
            
        })

    })

 
</script>

